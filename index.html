<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Juego Parejas ‚ù§Ô∏è</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        /* ESTILOS GENERALES */
        * { box-sizing: border-box; touch-action: manipulation; }
        body { font-family: 'Segoe UI', sans-serif; background-color: #fdf2f8; color: #831843; margin: 0; padding: 10px; text-align: center; }
        
        .card { background: white; padding: 20px; border-radius: 20px; box-shadow: 0 4px 15px rgba(219, 39, 119, 0.1); max-width: 500px; margin: 10px auto; }
        button { width: 100%; padding: 12px; background: #db2777; color: white; border: none; border-radius: 12px; font-weight: bold; font-size: 16px; margin-top: 10px; }
        button:disabled { background: #fbcfe8; opacity: 0.6; }
        input { width: 100%; padding: 10px; border: 2px solid #fbcfe8; border-radius: 10px; text-align: center; font-size: 16px; margin-bottom: 10px;}
        
        /* ESTILOS DEL JUEGO COLORES */
        .color-grid { display: grid; grid-template-columns: repeat(8, 1fr); gap: 2px; margin-top: 10px; background: #eee; padding: 2px; border-radius: 8px; }
        .color-cell { aspect-ratio: 1; border-radius: 3px; position: relative; }
        
        /* Etiquetas de filas y columnas */
        .grid-wrapper { display: flex; flex-direction: column; align-items: center; }
        .col-labels { display: grid; grid-template-columns: repeat(8, 1fr); width: 100%; padding-left: 20px; font-size: 10px; font-weight: bold; color: #888; margin-bottom: 2px; }
        .row-container { display: flex; width: 100%; }
        .row-labels { display: flex; flex-direction: column; justify-content: space-around; width: 20px; font-size: 10px; font-weight: bold; color: #888; height: auto; }

        /* Cursores */
        .selected { border: 2px solid white; box-shadow: 0 0 0 2px #db2777; z-index: 10; transform: scale(1.2); }
        .target-mark::after { content: "‚òÖ"; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-size: 14px; text-shadow: 0 0 2px black; }

        /* Tarjeta de C√≥digo */
        .code-card { background: #fee2e2; padding: 15px; border-radius: 10px; border: 2px dashed #db2777; margin-bottom: 15px; }
        .code-big { font-size: 40px; font-weight: 900; letter-spacing: 2px; }

        /* Puntuaci√≥n Flotante */
        .score-popup { font-size: 50px; font-weight: 900; color: #059669; animation: pop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes pop { 0% { transform: scale(0); } 100% { transform: scale(1); } }
        
        /* Chat */
        .chat-btn { position: fixed; top: 15px; right: 15px; background: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1); border: 2px solid #fbcfe8; z-index: 100; font-size: 20px;}
        .chat-box { position: fixed; top: 60px; right: 15px; left: 15px; height: 300px; background: white; border: 2px solid #db2777; border-radius: 15px; z-index: 99; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        // --- 1. CONFIGURACI√ìN (YA PUSE TUS CLAVES) ---
        const firebaseConfig = {
          apiKey: "AIzaSyCbKOu5vwGbowuI5CfbygKJtYujAKa6zJ0",
          authDomain: "juegos-tiktok.firebaseapp.com",
          databaseURL: "https://juegos-tiktok-default-rtdb.europe-west1.firebasedatabase.app",
          projectId: "juegos-tiktok",
          storageBucket: "juegos-tiktok.firebasestorage.app",
          messagingSenderId: "504168913042",
          appId: "1:504168913042:web:e9eba88e01f94bcc7a2e4b"
        };

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // --- 2. JUEGO DE COLORES (FINAL) ---
        
        const ROWS_LABELS = ["A","B","C","D","E","F","G","H","I","J","K","L"];
        const COLS_LABELS = ["1","2","3","4","5","6","7","8"];
        
        const getColor = (r, c) => {
            const hue = Math.floor((360 / 12) * r);
            const light = 90 - (c * 8); 
            return `hsl(${hue}, 85%, ${light}%)`;
        };

        const ColorGame = ({ roomId, playerRole, roomData }) => {
            const game = roomData.colorGame || {};
            const isMyTurnToGive = game.turn === playerRole;
            const isMyTurnToGuess = game.turn && game.turn !== playerRole;
            
            const nextTurn = () => {
                const nextPlayer = (!game.turn || game.turn === 'guest') ? 'host' : 'guest';
                const r = Math.floor(Math.random() * 12);
                const c = Math.floor(Math.random() * 8);
                
                db.ref(`salas/${roomId}/colorGame`).set({
                    turn: nextPlayer,
                    target: { r, c, code: ROWS_LABELS[r] + COLS_LABELS[c] },
                    phase: 'HINTING',
                    hint: '',
                    guess: null,
                    score: 0
                });
            };

            const sendHint = (text) => {
                db.ref(`salas/${roomId}/colorGame`).update({ hint: text, phase: 'GUESSING' });
            };

            const makeGuess = (r, c) => {
                if (game.phase !== 'GUESSING' || !isMyTurnToGuess) return;
                const dist = Math.max(Math.abs(game.target.r - r), Math.abs(game.target.c - c));
                const points = dist === 0 ? 3 : (dist === 1 ? 2 : (dist === 2 ? 1 : 0));
                db.ref(`salas/${roomId}/colorGame`).update({ guess: { r, c }, phase: 'RESULT', score: points });
            };

            if (!game.turn) {
                return (
                    <div className="card">
                        <h3>üé® Colores por Turnos</h3>
                        <p>Uno recibe un c√≥digo (ej: F7) y da una pista.</p>
                        {playerRole === 'host' ? 
                            <button onClick={nextTurn}>EMPEZAR PARTIDA</button> : 
                            <p className="pulse">Esperando al anfitri√≥n...</p>
                        }
                    </div>
                );
            }

            const currentActorName = game.turn === 'host' ? roomData.players.host.name : roomData.players.guest.name;

            return (
                <div className="card" style={{maxWidth: '100%', padding:10}}>
                    <div style={{display:'flex', justifyContent:'space-between', marginBottom:10}}>
                        <span style={{fontWeight:'bold'}}>Turno de: {currentActorName}</span>
                    </div>

                    {isMyTurnToGive && (
                        <div className="code-card">
                            <div>TU C√ìDIGO:</div>
                            <div className="code-big">{game.target.code}</div>
                            <div style={{height: 20, background: getColor(game.target.r, game.target.c), width: '100%', borderRadius:5, marginTop:5}}></div>
                            
                            {game.phase === 'HINTING' && (
                                <div style={{marginTop:10}}>
                                    <input id="hintIn" placeholder="Escribe tu pista..." />
                                    <button onClick={() => sendHint(document.getElementById('hintIn').value)}>ENVIAR PISTA</button>
                                </div>
                            )}
                            {game.phase === 'GUESSING' && <p>üëÄ Mira c√≥mo intenta adivinar...</p>}
                        </div>
                    )}

                    {isMyTurnToGuess && (
                        <div style={{marginBottom:15}}>
                            {game.phase === 'HINTING' ? (
                                <div className="pulse" style={{fontSize:20}}>‚è≥ Esperando pista...</div>
                            ) : (
                                <div style={{fontSize:22, fontWeight:'bold', padding:10, background:'#e0e7ff', borderRadius:10, color:'#3730a3'}}>
                                    PISTA: "{game.hint}"
                                </div>
                            )}
                        </div>
                    )}

                    {game.phase === 'RESULT' && (
                        <div style={{margin:'20px 0'}}>
                            <div className="score-popup">+{game.score} PUNTOS</div>
                            <button onClick={nextTurn}>SIGUIENTE TURNO ‚û§</button>
                        </div>
                    )}

                    <div className="grid-wrapper">
                        <div className="col-labels">{COLS_LABELS.map(l => <span key={l}>{l}</span>)}</div>
                        <div className="row-container">
                            <div className="row-labels">{ROWS_LABELS.map(l => <span key={l}>{l}</span>)}</div>
                            <div className="color-grid" style={{width:'100%', opacity: (game.phase === 'HINTING' && isMyTurnToGuess) ? 0.3 : 1}}>
                                {Array.from({ length: 96 }).map((_, i) => {
                                    const r = Math.floor(i / 8);
                                    const c = i % 8;
                                    const isTarget = game.target && game.target.r === r && game.target.c === c;
                                    const isGuess = game.guess && game.guess.r === r && game.guess.c === c;
                                    
                                    let classes = "color-cell";
                                    if (game.phase === 'RESULT') {
                                        if (isTarget) classes += " target-mark";
                                        if (isGuess) classes += " selected";
                                    } else {
                                        if (isMyTurnToGive && isTarget) classes += " target-mark";
                                    }

                                    return (
                                        <div key={i} className={classes} style={{backgroundColor: getColor(r, c)}} onClick={() => makeGuess(r, c)}></div>
                                    );
                                })}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- 3. APP PRINCIPAL ---
        function App() {
            const [view, setView] = React.useState('lobby');
            const [playerName, setPlayerName] = React.useState(localStorage.getItem('name') || '');
            const [roomId, setRoomId] = React.useState('');
            const [playerRole, setPlayerRole] = React.useState('');
            const [roomData, setRoomData] = React.useState(null);
            const [showChat, setShowChat] = React.useState(false);
            const [chatMsg, setChatMsg] = React.useState('');
            const [messages, setMessages] = React.useState([]);

            React.useEffect(() => { localStorage.setItem('name', playerName); }, [playerName]);

            React.useEffect(() => {
                if (roomId) {
                    db.ref('salas/' + roomId).on('value', snap => {
                        const data = snap.val();
                        if (data) {
                            setRoomData(data);
                            if (view === 'waiting' && data.players.guest) setView('game');
                            if (data.chat) setMessages(Object.values(data.chat));
                        }
                    });
                }
            }, [roomId, view]);

            const createRoom = () => {
                const id = Math.random().toString(36).substring(2,6).toUpperCase();
                db.ref('salas/'+id).set({ players: { host: { name: playerName } }, gameState: 'LOBBY' });
                setRoomId(id); setPlayerRole('host'); setView('waiting');
            };

            const joinRoom = (code) => {
                db.ref('salas/'+code).once('value', snap => {
                    if(snap.exists()) {
                        db.ref('salas/'+code+'/players/guest').set({ name: playerName });
                        setRoomId(code); setPlayerRole('guest'); setView('game');
                    }
                });
            };

            const sendChat = () => {
                if(!chatMsg) return;
                db.ref('salas/'+roomId+'/chat').push({ user: playerName, text: chatMsg });
                setChatMsg('');
            };

            return (
                <div>
                    {roomId && (
                        <>
                            <div className="chat-btn" onClick={() => setShowChat(!showChat)}>üí¨</div>
                            {showChat && (
                                <div className="chat-box">
                                    <div style={{flex:1, overflowY:'auto', padding:10, textAlign:'left'}}>
                                        {messages.map((m,i) => <div key={i} style={{marginBottom:5}}><b>{m.user}:</b> {m.text}</div>)}
                                    </div>
                                    <div style={{display:'flex', padding:10, background:'#eee'}}>
                                        <input value={chatMsg} onChange={e=>setChatMsg(e.target.value)} style={{marginBottom:0, flex:1}}/>
                                        <button onClick={sendChat} style={{width:'auto', margin:'0 0 0 5px', padding:'0 15px'}}>‚û§</button>
                                    </div>
                                </div>
                            )}
                        </>
                    )}

                    {view === 'lobby' && (
                        <div className="card">
                            <h1>Parejas ‚ù§Ô∏è</h1>
                            <input value={playerName} onChange={e=>setPlayerName(e.target.value)} placeholder="Tu Nombre" />
                            <button onClick={createRoom}>Crear Sala</button>
                            <input id="c" placeholder="C√ìDIGO" style={{textTransform:'uppercase', marginTop:20}}/>
                            <button style={{background:'#8b5cf6'}} onClick={()=>joinRoom(document.getElementById('c').value.toUpperCase())}>Unirse</button>
                        </div>
                    )}

                    {view === 'waiting' && <div className="card"><h2>{roomId}</h2><p className="pulse">Esperando...</p></div>}

                    {view === 'game' && roomData && <ColorGame roomId={roomId} playerRole={playerRole} roomData={roomData} />}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
