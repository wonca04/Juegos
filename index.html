<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego Parejas</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #fdf2f8; color: #831843; margin: 0; padding: 20px; text-align: center; }
        .card { background: white; padding: 20px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); max-width: 400px; margin: 0 auto; }
        input { width: 90%; padding: 12px; margin: 10px 0; border: 2px solid #fbcfe8; border-radius: 10px; font-size: 16px; text-align: center; outline: none; }
        input:focus { border-color: #db2777; }
        button { width: 100%; padding: 12px; background: #db2777; color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 10px; transition: 0.2s; }
        button:active { transform: scale(0.98); }
        .btn-secondary { background: #8b5cf6; }
        .status { margin-top: 20px; padding: 10px; background: #ecfdf5; color: #065f46; border-radius: 10px; border: 1px solid #a7f3d0; }
        .code-display { font-size: 2em; letter-spacing: 5px; font-weight: bold; color: #db2777; margin: 10px 0; }
        .waiting { animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        /* Chat Flotante */
        .chat-btn { position: fixed; top: 15px; right: 15px; background: white; padding: 10px; border-radius: 50%; box-shadow: 0 4px 10px rgba(0,0,0,0.2); cursor: pointer; z-index: 1000; }
        .chat-overlay { position: fixed; top: 70px; right: 20px; width: 300px; height: 400px; background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); z-index: 999; display: flex; flex-direction: column; overflow: hidden; border: 2px solid #fbcfe8; }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        // --- 1. CONFIGURACI√ìN FIREBASE (¬°PON TUS CLAVES AQU√ç!) ---
        const firebaseConfig = {
            apiKey: "AQUI_TU_API_KEY",
            authDomain: "TU_PROYECTO.firebaseapp.com",
            databaseURL: "TU_URL_DATABASE",
            projectId: "TU_ID",
            storageBucket: "...",
            messagingSenderId: "...",
            appId: "..."
        };

        // Inicializar Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.database();

        // --- 2. COMPONENTES DE LA APP ---

        function App() {
            const [view, setView] = React.useState('lobby'); // lobby, game
            const [playerName, setPlayerName] = React.useState(localStorage.getItem('nombre') || '');
            const [roomId, setRoomId] = React.useState('');
            const [playerRole, setPlayerRole] = React.useState('');
            const [roomData, setRoomData] = React.useState(null);
            const [showChat, setShowChat] = React.useState(false);

            // Guardar nombre
            React.useEffect(() => { localStorage.setItem('nombre', playerName); }, [playerName]);

            // Escuchar cambios de la sala
            React.useEffect(() => {
                if (roomId) {
                    const roomRef = db.ref('salas/' + roomId);
                    roomRef.on('value', (snapshot) => {
                        const data = snapshot.val();
                        if (data) {
                            setRoomData(data);
                            if (data.players.guest && view === 'lobby') {
                                setView('game');
                            }
                        }
                    });
                    return () => roomRef.off();
                }
            }, [roomId]);

            // Crear Sala
            const createRoom = () => {
                if (!playerName) return alert("¬°Pon tu nombre!");
                const newId = Math.random().toString(36).substring(2, 6).toUpperCase();
                db.ref('salas/' + newId).set({
                    players: { host: { name: playerName } },
                    gameState: 'LOBBY'
                });
                setRoomId(newId);
                setPlayerRole('host');
                setView('waiting');
            };

            // Unirse a Sala
            const joinRoom = (code) => {
                if (!playerName) return alert("¬°Pon tu nombre!");
                const codeUpper = code.toUpperCase();
                db.ref('salas/' + codeUpper).once('value', (snapshot) => {
                    if (snapshot.exists()) {
                        db.ref('salas/' + codeUpper + '/players/guest').set({ name: playerName });
                        setRoomId(codeUpper);
                        setPlayerRole('guest');
                        setView('game');
                    } else {
                        alert("Sala no encontrada");
                    }
                });
            };

            // VISTAS
            return (
                <div>
                    {/* Bot√≥n Chat Global */}
                    {view !== 'lobby' && (
                        <div className="chat-btn" onClick={() => setShowChat(!showChat)}>üí¨</div>
                    )}
                    
                    {showChat && (
                        <div className="chat-overlay">
                            <div style={{padding: 10, background:'#fdf2f8', borderBottom:'1px solid #ddd'}}>Chat de Pareja ‚ù§Ô∏è</div>
                            <div style={{flex:1, padding:10, background:'white'}}>Pr√≥ximamente...</div>
                        </div>
                    )}

                    <h1 style={{color: '#be185d'}}>Nuestra App ‚ù§Ô∏è</h1>

                    {/* VISTA 1: LOBBY */}
                    {view === 'lobby' && (
                        <div className="card">
                            <h3>¬øQui√©n eres?</h3>
                            <input placeholder="Tu nombre" value={playerName} onChange={e => setPlayerName(e.target.value)} />
                            
                            <div style={{margin: '20px 0', borderTop: '1px solid #eee'}}></div>
                            
                            <button onClick={createRoom}>Crear Sala Nueva</button>
                            <p>- O -</p>
                            <input id="codeInput" placeholder="C√ìDIGO SALA" style={{textTransform:'uppercase'}} />
                            <button className="btn-secondary" onClick={() => joinRoom(document.getElementById('codeInput').value)}>Unirse</button>
                        </div>
                    )}

                    {/* VISTA 2: ESPERANDO */}
                    {view === 'waiting' && (
                        <div className="card">
                            <p className="waiting">Esperando a tu pareja...</p>
                            <div className="code-display">{roomId}</div>
                            <p>Dile que ponga este c√≥digo</p>
                        </div>
                    )}

                    {/* VISTA 3: JUEGO (MENU) */}
                    {view === 'game' && roomData && (
                        <div className="card">
                            <div className="status">
                                ‚úÖ Conectados: <b>{roomData.players.host?.name}</b> y <b>{roomData.players.guest?.name || '...'}</b>
                            </div>
                            
                            <h3>Elige Juego</h3>
                            <button onClick={() => alert("Pronto: Colores")}>üé® Colores (Coop)</button>
                            <button onClick={() => alert("Pronto: Dial")}>üåä Wavelength</button>
                            <button onClick={() => alert("Pronto: Caf√©")}>‚òï Caf√© o T√©</button>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
